---
title: "Environment"
linkTitle: "Environment"
weight: 1
description: >
  Learn to build the development environment suggested by Enduro.
---

Enduro does not have a development mode with all dependencies mocked or stubbed.
The dependencies need to be installed for Enduro to work. To make this process
easier we offer an environment based on Docker Compose where we run all the
dependencies as Docker containers.

But for Enduro itself, we suggest to build it and run it locally because that
makes thing much simpler.

There are two main dependencies: [Go][go] and [Docker Compose][docker-compose].
Follow the links if you want to know how to install them. Use Go 1.13 or newer.

[Yarn][yarn] is also needed to build the web interface. You can
install it in Ubuntu like this:

```
curl -sL https://deb.nodesource.com/setup_14.x | sudo -E bash -
sudo apt-get install -y nodejs
curl -sL https://dl.yarnpkg.com/debian/pubkey.gpg | sudo apt-key add -
echo "deb https://dl.yarnpkg.com/debian/ stable main" | sudo tee /etc/apt/sources.list.d/yarn.list
sudo apt-get update && sudo apt-get install yarn
```

Install `make` and `gcc` in your system and then run `make tools` to
install some other local dependencies that you are going to need.

Spin up the environment with the following command:

    docker-compose up -d

Cadence will crash right away because the database has not been set up properly.
Run the following command to introduce the MySQL tables needed by Cadence:

    make cadence-seed

After a few seconds, Cadence should be up again. Since Cadence is a multitenant
service, we need to create a Cadence domain for Enduro:

    make cadence-domain

## Run your first test

In the environment that we've just build, Enduro monitors the pre-configured
blobstore so it can react to files uploded by the user.

Let's give it a try. Build Enduro's UI with:

    make migrations ui

And then run it with:

    make run

In a separate terminal download and configure Minio's client:

```
wget https://dl.min.io/client/mc/release/linux-amd64/mc
chmod +x mc
./mc config host add enduro http://127.0.0.1:7460 "36J9X8EZI4KEV1G7EHXA" "ECk2uqOoNqvtJIMQ3WYugvmNPL_-zm3WcRqP5vUM"
```

Uploading a file into the `sips` bucket should trigger the workflow:

    curl -s https://news.ycombinator.com/y18.gif | ./mc pipe enduro/sips/y18.gif

Most of our efforts right now are focused on processing SIPs generated by NHA
(our client). The repository contains a SIP creator that can be used as follows:

* Submit a single SIP:
  ```shell
  make -C hack/test-dpj
  ```
* Submit a SIP with an erroneous checksum manifest:
  ```shell
  make -C hack/test-dpj err
  ```
* Submit 10 SIPs with erroneous checksum manifests introduced randomly:
  ```shell
  make -C hack/test-dpj many TIMES=10
  ```

Additionally, you can visualize workflows and activities from Cadence Web. Try
opening the following link: http://127.0.0.1:7440/domain/enduro/workflows/.

## Development workflow

In most cases, you can build the application with `go build`. The executable
file is located in the `build` directory.

If you are looking for a source-code editor, Visual Studio Code has great Go
support. It uses the official language server, [gopls][gopls], which is it not
stable yet - it is recommendable to read their docs and keep it up to date.

This project uses GolangCI-Lint, a linters aggregator. Install it using the
example above. Run it with `golangci-lint run` or set it up in your editor.
This is how you can configure Visual Studio Code to use it:

```json
{
    "go.lintTool": "golangci-lint",
    "go.lintFlags": ["--fast"]
}
```


[docker-compose]: https://docs.docker.com/compose/install/
[go]: https://golang.org/doc/install
[gopls]: https://github.com/golang/tools/blob/master/gopls/README.md
[yarn]: https://yarnpkg.com/
